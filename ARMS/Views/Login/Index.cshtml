@{
    ViewData["Title"] = "Login";
}

<div class="page-login">
    <img src="@Url.Content("~/assets/photo/background.jpg")" alt=""/>
    <div>
        <div>
            <label>ARMS</label>
            <label>Welcome to Examination System</label>
            <label>Username</label>
            <input id="textfield-username" type="text" value="admin" class="main-textfield"/>
            <label>Password</label>
            <input id="textfield-password" type="password" value="123" class="main-textfield"/>
            <button id="button-login" class="main-btn main-btn-second" type="submit">
                <span>Login</span>
            </button>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            const reload = $('div[id$=main-reloading]');
            const header = $('.main-header');
            const content = $('.main-content');
            const login = $('.main-login');

            const btnLogin = $('#button-login');
            const txtUsername = $('#textfield-username');
            const txtPassword = $('#textfield-password');
            const lblUsername = $('#label-user');
            
            btnLogin.click(function() {
                reload.show();
                if (txtUsername.val().length !== 0 && txtPassword.val().length !== 0) {
                    $.ajax({
                        type: 'POST',
                        url: `@Url.Action("VerifyLogin", "Home")?username=${txtUsername.val().trimEnd()}&password=${txtPassword.val().trimEnd()}`,
                        cache: true
                    }).done(function(res) {
                        console.log(res);
                        if (!res['isSuccess']) {
                            reload.hide();
                            loadAssignmentInfo('Username or Password is incorrect');
                        } else {
                            lblUsername.text(res['loginUsername']);
                            login.hide();
                            header.show();
                            content.show();
                            $.get('@Url.Action("Index", "Browse")').done(function(result) {
                                $('#main-page').html(result);
                            }).fail(function(a, b, c) {
                                console.log('It is error');
                                console.log(c);
                                loadErrorPage();
                            });
                        }
                    }).fail(function(a, b, c) {
                        console.log('It is error');
                        console.log(c);
                        loadErrorPage();
                    });
                } else {
                    reload.hide();
                    loadAssignmentInfo('Username or Password must not be empty');
                }
            });

            function loadAssignmentInfo(info) {
                bootbox.alert(info).find('.modal-content').css({
                    'margin-top': function (){
                        const w = $( window ).height();
                        const b = $(".modal-dialog").height();
                        const h = (w - b) / 2;
                        return h + "px";
                    },
                    'width': '39rem'
                }); 
            }
            
            function loadErrorPage() {
                const url = '@Url.Action("ErrorPage", "Home")';
                $.ajax({
                    type: 'GET',
                    url: url,
                    cache: true
                }).done(function(res) {
                    $('#main-page').empty().append(res);
                    reload.hide();
                })
            }
        });
    </script>
</div>